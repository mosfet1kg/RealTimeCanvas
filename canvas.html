<!DOCTYPE html>
<html>
<head lang="en">
    <meta charset="UTF-8">
    <title></title>
    <link rel="stylesheet" href="/css/farbtastic.css">
    <script src="//code.jquery.com/jquery-1.11.2.min.js"></script>
    <link rel="stylesheet" href="/css/jquery-ui.min.css">
    <script src="/js/jquery-ui.min.js"></script>
    <script src="/js/farbtastic.js"></script>
    <script src="https://cdn.socket.io/socket.io-1.3.5.js"></script>
    <script>
        function Point(event, target){
            this.x = event.pageX - $(target).position().left;
            this.y = event.pageY - $(target).position().top;
        }
    </script>
    <script>
        $(document).ready(function(){
            var canvas = document.getElementById('canvas');
            var context = canvas.getContext('2d');

            var width = 5;
            var color = '#000000';
            var isDown = false;
            var newPoint, oldPoint;
            $('#penColor').css({background: color});

            $('#canvas').mousedown(function(event){
                isDown = true;

                oldPoint = new Point(event, this);
            }).mouseup( function(){
                isDown = false
            }).mousemove( function(event){
                if(isDown){
                    newPoint = new Point(event, this);
                    socket.emit('draw', {
                        width : width,
                        color : color,
                        x1: oldPoint.x,
                        y1: oldPoint.y,
                        x2: newPoint.x,
                        y2: newPoint.y
                    });

                    oldPoint = newPoint;
                }
            });


            var socket = io.connect( window.location.host );

            socket.emit('join', '<%= room %>');

            socket.on('line', function(data){

                context.lineWidth = data.width;
                context.strokeStyle = data.color;
                context.lineCap = 'round';
                context.beginPath();
                context.moveTo(data.x1, data.y1);
                context.lineTo(data.x2, data.y2);
                context.stroke();
            });

            $('#colorpicker').farbtastic(function(data){
                color = data;
                $('#penColor').css({background: color});
            });

            $('#slider').slider({
                max:20, min:1,
                value: 5,
                change: function(event, ui){
                    width = ui.value;
                }
            });
        });
    </script>
</head>
<body>

    <table border="10">
        <tr>
            <td rowspan="3">
                <canvas id="canvas" width="600" height="400" style="cursor: crosshair"></canvas>
            </td>
            <td height="200">
                <div id="colorpicker"></div>
            </td>
        </tr>
        <tr>
            <td height="25">
                <div id="slider"></div>
            </td>
        </tr>
        <tr>
            <td id='penColor'></td>
        </tr>
    </table>
</body>
</html>